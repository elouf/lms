{% extends 'base.html.twig' %}

{% block pageHeader %}
    <div class="page-header">
        <div class="container">
            {% if template == 'studit' %}
                <h2 class="color3">Bienvenue sur la plateforme de STUDIT</h2>
                <ul class="breadcrumb">
                    <li class="color3">Bibliothèque de ressources pédagogiques</li>
                </ul>
            {% elseif template == 'afadec' %}
                <h2 class="color3">Bienvenue sur la plateforme de l'AFADEC</h2>
                <ul class="breadcrumb">
                    <li class="color3">Association pour la Formation A Distance de l'Enseignement Catholique</li>
                </ul>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block main %}
    <script>
        jQuery(document).ready(function () {
            $('.resa-groupResa').click(function () {
                if ($(this).find('.resa-controls').hasClass('hidden')) {
                    $('.resa-controls').addClass('hidden');
                    $(this).find('.resa-controls').removeClass('hidden');
                } else {
                    $(this).find('.resa-controls').addClass('hidden');
                }
            });
            $('.resa-btn-inscr').click(function (e) {
                e.stopPropagation();
                let idGroupe = $(this).closest('.resa-groupResa').attr(("data-idGroup"));
                let system = $(this).closest('.resa-system');
                $.ajax({
                    type: 'POST',
                    url: "{{ path('inscrGroupeResa_ajax') }}",
                    async: true,
                    dataType: "json",
                    data: {
                        idGroupe: idGroupe
                    },
                    success: function (data) {
                        udpateResasNumbers(data, system)
                    },
                    error: function (xhr, status, error) {
                    }
                });
            });
            $('.resa-btn-desinscr').click(function (e) {
                e.stopPropagation();
                let system = $(this).closest('.resa-system');
                let idGroupe = $(this).closest('.resa-groupResa').attr(("data-idGroup"));
                $.ajax({
                    type: 'POST',
                    url: "{{ path('desinscrGroupeResa_ajax') }}",
                    async: true,
                    dataType: "json",
                    data: {
                        idGroupe: idGroupe
                    },
                    success: function (data) {
                        udpateResasNumbers(data, system)
                    },
                    error: function (xhr, status, error) {
                    }
                });
            });

            $('.btnAdminGroup').click(function(e){
                e.stopPropagation();
            });

            function udpateResasNumbers(data, system) {
                $('.myGroup').removeClass('myGroup');
                for (let i = 0; i < data['etat'].length; i++) {
                    let places = data['etat'][i]['places'];
                    let group = system.find('.resa-groupResa[data-idGroup="' + data['etat'][i]['groupId'] + '"]');
                    group.find('.placesRestantes').text(places);
                    if (places <= 0) {
                        group.find('.resa-btn-inscr').hide();
                    }
                    if (data['userGroupId'] === data['etat'][i]['groupId']) {
                        group.addClass('myGroup');
                    } else if (places > 0) {
                        group.find('.resa-btn-inscr').show();
                    }
                }

            }

            getGroupeResasNumbers();
            setInterval(function () {
                getGroupeResasNumbers();
            }, 15000);

            function getGroupeResasNumbers() {
                $('.resa-system').each(function () {
                    let system = $(this);
                    let idSystem = system.attr('data-idSystem');
                    $.ajax({
                        type: 'POST',
                        url: "{{ path('getGroupeResasNumbers_ajax') }}",
                        async: true,
                        dataType: "json",
                        data: {
                            idSystem: idSystem
                        },
                        success: function (data) {
                            udpateResasNumbers(data, system);
                        },
                        error: function (xhr, status, error) {
                        }
                    });
                });
            }
        });
    </script>

    <div class="container mb-60 mt-20">
        <div class="row mt-20">

            {% if not app.user %}
                {% block fos_user_content %}
                {% endblock fos_user_content %}
            {% endif %}

            <div class="
                    {% if app.user %}
                        {% if template == "excellencePro" %}
                        col-md-12 col-lg-12 col-xl-12
                        {% else %}
                        col-md-5 col-lg-6 col-xl-8
                        {% endif %}
                    {% else %}
                        col-md-8 col-md-pull-4
                    {% endif %}
                ">
                {% if template == 'studit' %}
                    <img src="{{ asset('educomp/images/logoSTUDIT.png') }}" alt="">
                {% elseif template == 'afadec' %}

                    <!--<h4 class="heading pt-20 text-center mb-0">Une entrée dans la nouvelle année <span
                                class="color2">dans l’Espérance…</span>
                    </h4>-->

                    {#<img style="max-width: 100%;" src="{{ asset('images/accueil/afadec_noel2019.jpg') }}" />#}
                    <h4 class="heading pt-20 text-center mb-0">DÉCOUVREZ L’AFADEC <span
                                class="color2">EN 2 MINUTES</span>
                    </h4>
                    <iframe class="" width="100%" height="430" frameborder="0" allowfullscreen=""
                            mozallowfullscreen="" webkitallowfullscreen=""
                            src="https://player.vimeo.com/video/123835230"></iframe>

                {% elseif template == "excellencePro" %}
                    <video controls poster="{{ asset('images/accueil/excellencePro.jpg') }}" style="width: 100%">
                        <source src="{{ asset('images/accueil/generique_excellence.mp4') }}" type="video/mp4">
                        <img style="max-width: 100%;" src="{{ asset('images/accueil/excellencePro.jpg') }}"/>
                    </video>

                {% endif %}
            </div>
            {% if template == "afadec" %}
                {% if app.user %}
                    <div class="col-md-7 col-lg-6 col-xl-4">
                        {% include "calendrier/calendrierWidget.html.twig" %}
                    </div>
                {% endif %}
            {% endif %}
        </div>
        {% if systemResas is defined %}
            <div class="row mt-20">
                <div class="col-sm-12">
                    <h4 class="heading">Réservation de plage horaire</h4>
                    {% for system in systemResas %}
                        <div class="resa-system col-sm-6" data-idSystem="{{ system.id }}">
                            <div class="resa-systemNom">{{ system.nom }}</div>
                            <div class="resa-systemDescr">{{ system.description|raw }}</div>
                            <div class="resa-groupsResaContainer">
                                {% for group in system.groups %}
                                    <div class="resa-groupResa" data-idGroup="{{ group.id }}">
                                        <div class="resa-groupResaNom">
                                            <div class="resa-groupResaNomStr">{{ group.nom }}</div>
                                            {% if app.user.hasRole('ROLE_SUPER_ADMIN') %}
                                                <a class="btnAdminGroup" target="_blank" href="{{ path('admin_app_grouperesa_edit', {id: group.id}) }}">
                                                    <i class="fa fa-cog" aria-hidden="true"></i>
                                                </a>
                                            {% endif %}
                                        </div>
                                        <div class="resa-groupResaContent">
                                            <div class="resa-groupResaDescr">{{ group.description|raw }}</div>
                                            {% set nbPlaces = group.max - group.users|length %}
                                            <div>Places restantes : <span class="placesRestantes">{{ nbPlaces }}</span>
                                            </div>
                                            <div class="resa-iAmIn">Mon inscription est enregistrée dans ce groupe</div>
                                        </div>
                                        <div class="resa-controls hidden">
                                            <div class="resa-btn resa-btn-inscr">S'inscrire</div>
                                            <div class="resa-btn resa-btn-desinscr">Se désinscrire</div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
        {% if template == "afadec" %}
            <div class="row mt-40">
                <div class="col-sm-12">
                    <div class="col-sm-12">
                        <div class="row bgcolor3 pt-20">
                            <div class="col-sm-12">
                                <figcaption>
                                    <h4 class="img-title">Testez <span class="color2">nos modules</span></h4>
                                </figcaption>
                            </div>


                            <div class="col-sm-3">
                                <figure class="effect-sadie">
                                    <a target="_blank"
                                       href="http://www.e-educmaster.com/data_AFADEC/1er_degre/maths_remediation3_NDiaye_2013_capt/afadec_puissance.htm">
                                        <img src="{{ asset('images/accueil/maths_lesPuissances.png') }}"
                                             class="img-responsive" alt="Mathématiques CRPE Remédiation">
                                        <figcaption>
                                            <h6 class="img-title">Mathématiques CRPE Remédiation - <span class="color2">Les puissances</span>
                                            </h6>
                                        </figcaption>
                                    </a>
                                </figure>
                            </div>
                            <div class="col-sm-3">
                                <figure class="effect-sadie">
                                    <a target="_blank"
                                       href="http://www.e-educmaster.com/data_AFADEC/1er_degre/Francais_Fiche_AccordParticipe_LeBellego_2013_op/co/Fiche1D_LeBellegoSansProdEleve_web.html">
                                        <img src="{{ asset('images/accueil/fra_accord_partPass.png') }}"
                                             class="img-responsive" alt="Français CRPE Remédiation">
                                        <figcaption>
                                            <h6 class="img-title">Français CRPE Remédiation - <span class="color2">L’accord du participe passé</span>
                                            </h6>
                                        </figcaption>
                                    </a>
                                </figure>
                            </div>
                            <div class="col-sm-3">
                                <figure class="effect-sadie">
                                    <a target="_blank"
                                       href="http://www.e-educmaster.com/data_AFADEC/2d_degre/SVT_cor_biol_ESTIENNE_2013_wbm/index.html">
                                        <img src="{{ asset('images/accueil/svt_corrBio.png') }}"
                                             class="img-responsive wp-post-image" alt="SVT CAFEP Corrigé">
                                        <figcaption>
                                            <h6 class="img-title">SVT CAFEP Corrigé de sujet format concours en <span
                                                        class="color2">biologie</span></h6>
                                        </figcaption>
                                    </a>
                                </figure>
                            </div>
                            <div class="col-sm-3">
                                <figure class="effect-sadie">
                                    <a target="_blank"
                                       href="http://www.e-educmaster.com/data_AFADEC/2d_degre/anglais_fiche_VoixPassive_Webster_2013_op/co/Voix_Passive_web.html">
                                        <img src="{{ asset('images/accueil/anglaisGrammVoixPassive.png') }}"
                                             class="img-responsive wp-post-image" alt="Anglais CAFEP Grammaire">
                                        <figcaption>
                                            <h6 class="img-title">Anglais CAFEP Grammaire de traduction - <span
                                                        class="color2">Voix passive</span></h6>
                                        </figcaption>
                                    </a>
                                </figure>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            {% include 'pagesFixes/afadecContent.html.twig' %}
            {% elseif template == "excellencePro" %}

            <div class="row mt-20">
                <div class="col-sm-12">
                    <h4 class="heading">Mentions Légales</h4>

                    <p>L'AFADEC (Association de la Formation A Distance de l'Enseignement Catholique) administre
                        cette plateforme, dont l'objectif est d'accompagner la formation au salon Excellence Pro</p>

                    <p>Les informations recueillies (nom, prénom, discipline, adresse mail, numéro de téléphone,
                        établissement) sont nécessaires pour votre inscription.</p>

                    <p>Elles font l'objet d'un traitement informatique et sont destinées au secrétariat de
                        l'association.</p>

                    <p>En application des articles 39 et suivants de la loi du 6 janvier 1978 modifiée, vous
                        bénéficiez d'un droit d'accès et de rectification aux informations qui vous concernent.</p>

                    <p>Si vous souhaitez exercer ce droit et obtenir communication des informations vous concernant,
                        veuillez vous adresser à : <a
                                href="mailTo:contact.afadec@gmail.com">contact.AFADEC@gmail.com</a>
                    </p>
                </div>
            </div>

            <!-- Parallax Version 1.4.2 -->
            <script src="{{ asset('educomp/js/parallax.js') }}" type="text/javascript"></script>

            <script src="{{ asset('educomp/js/jquery.validate.min.js') }}" type="text/javascript"></script>
        {% endif %}
    </div>
    {% if template == "afadec" %}
        {% if app.user %}
            {% include "calendrier/calendrierPopup.html.twig" %}
        {% endif %}
    {% endif %}
{% endblock %}